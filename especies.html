<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Esp√©cies Observadas - Big Day</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .container { max-width: 900px; margin: 24px auto; padding: 16px; }
    .back { margin-bottom: 12px; display:inline-block; text-decoration:none; color:#2b6cb0; font-weight:600; }
    .species-table { width: 100%; }
    .species-table th { text-align: left; }
    .species-table td:nth-child(1) { text-align: center; width: 80px; }
    .species-header { text-align: center; margin-bottom: 20px; }
    /* Zebrado adicionado */
    .species-table tbody tr:nth-child(odd) { background: #fff; }
    .species-table tbody tr:nth-child(even) { background: #fbfcff; }
    .species-table tbody td { padding: 10px; border-bottom: 1px solid #f0f2f6; }
  </style>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <main class="container">
    <a class="back" href="index.html">‚Üê Voltar ao Ranking</a>
    
    <header class="header">
      <!-- Logo PNG com fundo transparente -->
      <div class="logo" id="logo">
        <img src="logo.png" alt="Big Day Logo" class="logo-image">
      </div>
      <h1 class="event-title">1¬∫ Big Day RS</h1>
      
      <!-- Link para p√°gina de esp√©cies -->
      <div class="species-link">
        <a href="especies.html">üìã Ver Lista Completa de Esp√©cies</a>
      </div>
    </header>

    <div class="card">
      <div class="table-wrap">
        <table id="species-table" class="species-table">
          <thead>
            <tr>
              <th>Observa√ß√µes</th>
              <th>Nome Popular</th>
              <th>Nome Cient√≠fico</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="update-footer">
      <p>Dados atualizados at√©: <strong id="update-date">Carregando...</strong></p>
    </div>
  </main>

  <script>
    // Fun√ß√£o para processar CSV
    function parseCSV(csvText) {
      const lines = csvText.split('\n').filter(line => line.trim() !== '');
      const headers = lines[0].split(';').map(header => header.trim());
      
      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(';').map(value => value.trim());
        const item = {};
        headers.forEach((header, index) => {
          item[header] = values[index] || '';
        });
        data.push(item);
      }
      return data;
    }

    // Fun√ß√£o para renderizar a tabela
    function renderSpeciesTable(data) {
      const tbody = document.querySelector('#species-table tbody');
      tbody.innerHTML = '';
      
      data.forEach(species => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${species.observacoes}</td>
          <td>${species.nome_popular}</td>
          <td><em>${species.nome_cientifico}</em></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Fun√ß√£o para buscar dados de atualiza√ß√£o do script principal
    function loadUpdateDate() {
      // Tenta buscar do script.js principal
      if (typeof getUpdateText === 'function') {
        document.getElementById('update-date').textContent = getUpdateText();
      } else {
        // Fallback - voc√™ pode definir uma data manualmente aqui
        document.getElementById('update-date').textContent = '31 de dezembro de 2024, 23:59';
      }
    }

    // Fun√ß√£o para carregar dados de arquivo CSV externo
    async function loadCSVFromFile() {
      try {
        // Tenta carregar do caminho raiz primeiro (GitHub Pages)
        const response = await fetch('/especies.csv');
        if (response.ok) {
          const csvText = await response.text();
          return parseCSV(csvText);
        }
      } catch (error) {
        console.log('Tentando caminho relativo...');
      }
      
      try {
        // Fallback: caminho relativo (desenvolvimento local)
        const response = await fetch('especies.csv');
        if (response.ok) {
          const csvText = await response.text();
          return parseCSV(csvText);
        }
      } catch (error) {
        console.error('Erro ao carregar especies.csv:', error);
      }
      
      // Retorna array vazio se n√£o encontrar o arquivo
      return [];
    }

    // Inicializa√ß√£o
    async function init() {
      const speciesData = await loadCSVFromFile();
      
      if (speciesData.length === 0) {
        // Mostra mensagem de erro se n√£o encontrar CSV
        const tbody = document.querySelector('#species-table tbody');
        tbody.innerHTML = `
          <tr>
            <td colspan="3" style="text-align: center; padding: 20px; color: #718096;">
              Arquivo especies.csv n√£o encontrado. 
              Por favor, verifique se o arquivo est√° na pasta correta.
            </td>
          </tr>
        `;
      } else {
        renderSpeciesTable(speciesData);
      }
      
      loadUpdateDate();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
